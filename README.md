# Информация о подключаемых к АРМ usb устройств

## Общая информация

### **Описание**:
Скрипт получает временные метки, когда была произведена попытка подключения внешнего USB Mass Storage device на АРМ и кем. <br>
Фиксируются также vid/pid устройства. <br>
sid, dateFrom, dateTo - аргументы фильтры. При их отсутствии скрипт вернет всю доступную релевантную информацию из журнала.

### **Имя файла**
usb_connect_events_linux.py

### **Категория**
Обогащение данных.

### **Платформа**
- windows
- linux

### **Теги**
- linux
- ssh

## Предварительные требования
Настройка ssh на удаленном хосте. <br>
Протестированные ОС: Ubuntu 18/22, AltServer 10.
__________

## Параметры скрипта.

### **Окружение**
Интерпретатор: python3.8. <br>
Локаль: EN. <br>
Зависимости:
- paramiko>=2.7.2
- pytz>=2023.3

### **Повышенные привилегии**
Нет.

### **Input**
| Аргумент | Тип | Обязательный | По умолчанию | Описание | Возможный вариант |
|---|---|---|---|---|---|
| hostname | str | Да | - | Имя целевой машины. Например, pc-001. | ipv4 |
| port | int | Нет | - | Порт для подключения по ssh (по умолчанию 22). Например, 2222. | - |
| userName | str | Нет | - | Имя пользователя по которому необходимо извлечь события. Например, 'user'. | - |
| dateFrom | str | Нет | - | Дата с которой начать поиск событий. Формат даты ISO8601. Например, 2023-04-09T11:32:00Z. | - |
| dateTo | str | Нет | - | Дата окончания поиска событий. Формат даты ISO8601. Например, 2023-04-09T11:32:00Z. | - |
| timezone | str | Нет | - | Часовой пояс (смещение времени относительно UTC). По умолчанию 'UTC'. Например, 'Asia/Yekaterinburg'. | - |

### **Secrets**
| Аргумент | Тип | Теги | Описание |  Возможный вариант |
|---|---|---|---|---|
| linux_login | str | linux | Имя пользователя, под которым заходим на машину. Например, JohnDoe. |  |
| linux_password | str | linux | Пароль от пользователя. Например, qwerty123. |  |

### **Output**
| Аргумент | Тип | Обязательный | По умолчанию | Описание | Возможный вариант |
|---|---|---|---|---|---|
| usbConnectEvents | list | да | - | Содержит объекты с информацией о подключаемых USB Mass Storage device. | - |
| machineName | str | да | - | Содержит имя ПК на котором зарегистрировано событие. Например, 'DESKTOP-VDCVV3O'. | - |
| dateTime | str | да | - | Содержит дату и время события в формате ISO8601. Например, '2023-04-09T11:32:00Z'. | - |
| vid | str | да | - | Содержит vid устройства. Например, 'VID_090C'. | - |
| pid | str | да | - | Содержит pid устройства. Например, 'PID_1000'. | - |
| userName | str | нет | - | Содержит имя пользователя подключившего устройство. Например, 'JohnDoe'. | - |

### **Пример запуска**
```python
python usb_connect_events_linux.py '{"ipv4": "10.51.22.15", "dateFrom": "2023-06-20T07:36:33Z", "dateTo": "2024-06-20T07:36:33Z"}' '{"secrets":{"linux_login": "user", "linux_password": "P@ssw0rd"}}'
```

### **Пример вывода**
```json
{
  "ipv4": "10.54.20.79",
  "userName": "test_user",
  "dateFrom": "2023-06-20T07:36:33Z",
  "dateTo": "2024-06-20T07:36:33Z",
  "usbConnectEvents": [
    {
      "machineName": "Ubuntu-NB1",
      "dateTime": "2023-06-20T07:36:33Z",
      "vid": "090c",
      "pid": "1000",
      "userName": "test_user"
    }
  ]
}
```

### **Тесты**
`usb_connect_events_linux_tests.py`